C51 COMPILER V9.60.7.0   DS18B20                                                           11/11/2023 13:00:55 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\Objects\ds18b20.obj
COMPILER INVOKED BY: E:\keil1\C51\BIN\C51.EXE USER\DS18B20\ds18b20.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\USER;.\USER;.\USE
                    -R\iic;.\USER\EEPROM;.\USER\time;.\USER\DS18B20;.\USER\DS1302;.\USER\ired) DEBUG OBJECTEXTEND PRINT(.\Listings\ds18b20.ls
                    -t) TABS(2) OBJECT(.\Objects\ds18b20.obj)

line level    source

   1          #include "AllHead.h"
   2          
   3          /*******************************************************************************
   4          * º¯ Êý Ãû : ds18b20_reset
   5          * º¯Êý¹¦ÄÜ : ¸´Î» DS18B20
   6          * Êä Èë : ÎÞ
   7          * Êä ³ö : ÎÞ
   8          *******************************************************************************/
   9          //void ds18b20_reset(void)
  10          //{
  11          //  DS18B20_PORT = 0; //À­µÍ DQ
  12          //  delay_10us(75);   //ÑÓÊ±750Î¢Ãë
  13          //  DS18B20_PORT = 1; //À­¸ßDQ DQ = 1
  14          //  delay_10us(2);    //ÑÓÊ±20Î¢Ãë
  15          //} 
  16          
  17          ///*******************************************************************************
  18          //* º¯ Êý Ãû : ds18b20_check
  19          //* º¯Êý¹¦ÄÜ : ¼ì²â DS18B20 ÊÇ·ñ´æÔÚ
  20          //* Êä Èë : ÎÞ
  21          //* Êä ³ö : 1:Î´¼ì²âµ½ DS18B20 µÄ´æÔÚ£¬0:´æÔÚ
  22          //*******************************************************************************/
  23          //u8 ds18b20_check(void)
  24          //{
  25          //  u8 time_temp = 0;  //ÉèÖÃÊ±¼ä±äÁ¿Ô­ÒòÊÇÈç¹ûDQÒ»Ö±Îª¸ßµçÆ½µÄ»°²»ÄÜÒ»Ö±ÔÚÕâÀïËÀÑ­»·£¬Èç¹ûµÈ´ýÒ»»áDQ»¹ÊÇ¸ß
             -µçÆ½µÄ»°ÔòÇ¿ÖÆÍË³ö
  26          //  while(DS18B20_PORT && time_temp < 20) //µÈ´ýDQÎªµÍµçÆ½(Èç¹ûDQÎª1ÇÒÊ±¼ä±äÁ¿Ð¡ÓÚ20Ôò½øÈëÑ­»·£¬Èç¹ûÎªµÍµçÆ
             -½0ÔòÌø³öÑ­»·) 
  27          //  {
  28          //    time_temp++;  
  29          //    delay_10us(1);
  30          //  }
  31          //  if(time_temp >= 20) return 1; //Èç¹û³¬Ê±ÔòÇ¿ÖÆ·µ»Ø 1£¬Ö¤Ã÷DS18B20²»´æÔÚ
  32          //  else  time_temp = 0;
  33          //  
  34          //  while((!DS18B20_PORT) && time_temp < 20) //µÈ´ýDQÎª¸ßµçÆ½(Èç¹ûDQÎª0ÇÒÊ±¼ä±äÁ¿Ð¡ÓÚ20Ôò½øÈëÑ­»·£¬Èç¹ûÎª¸ß
             -µçÆ½1ÔòÌø³öÑ­»·) 
  35          //  {
  36          //    time_temp++;
  37          //    delay_10us(1);
  38          //  }
  39          //  if(time_temp >= 20) return 1; //Èç¹û³¬Ê±ÔòÇ¿ÖÆ·µ»Ø 1£¬Ö¤Ã÷DS18B20²»´æÔÚ
  40          //  else
  41          //    return 0; //Ö¤Ã÷DS18B20´æÔÚ
  42          //}
  43          
  44          ///*******************************************************************************
  45          //* º¯ Êý Ãû : ds18b20_init
  46          //* º¯Êý¹¦ÄÜ : ³õÊ¼»¯ DS18B20 µÄ IO ¿Ú DQ, Í¬Ê±¼ì²â DS µÄ´æÔÚ
  47          //* Êä Èë : ÎÞ
  48          //* Êä ³ö : 1:²»´æÔÚ£¬0:´æÔÚ
  49          //*******************************************************************************/
  50          //u8 ds18b20_init(void)
C51 COMPILER V9.60.7.0   DS18B20                                                           11/11/2023 13:00:55 PAGE 2   

  51          //{
  52          //  ds18b20_reset();
  53          //  return ds18b20_check();
  54          //}
  55          
  56          ///*******************************************************************************
  57          //* º¯ Êý Ãû         : ds18b20_write_byte
  58          //* º¯Êý¹¦ÄÜ       : Ð´Ò»¸ö×Ö½Úµ½DS18B20
  59          //* Êä    Èë         : dat£ºÒªÐ´ÈëµÄ×Ö½Ú
  60          //* Êä    ³ö         : ÎÞ
  61          //*******************************************************************************/
  62          //void ds18b20_write_byte(u8 dat)
  63          //{
  64          //  u8 i = 0;
  65          //  u8 temp = 0;
  66          //  for(i = 0;i < 8;i++) //Ñ­»·8´Î£¬Ã¿´ÎÐ´Ò»Î»£¬ÇÒÏÈÐ´µÍÎ»ÔÙÐ´¸ßÎ»
  67          //  {                    //ÀýÈçdataÎª 0101 1011
  68          //    temp = dat & 0x01; //Ñ¡ÔñµÍÎ»×¼±¸Ð´Èë(ÔòtempÎª0000 0001 )
  69          //    dat >>= 1;         //½«´ÎµÍÎ»ÒÆµ½×îµÍÎ»£¬ÀýÈçÒ»¿ªÊ¼datÎª0101 1011 ÏòÓÒÒÆ¶¯Ò»Î»Ôò±ä³É 0010 1101
  70          //    if(temp)           //Èç¹ûÐ´ 1 Ê±Ðò
  71          //    {
  72          //      DS18B20_PORT = 0;//Ö÷»úÀ­µÍ×ÜÏß
  73          //      _nop_();_nop_(); //ÑÓÊ±Á½ºÁÃë(¸Ãº¯ÊýÎªÍ·ÎÄ¼þintrins.hÀïµÄº¯Êý£¬Ò»¸ö_nop_()±íÊ¾ÑÓÊ± 1 ºÁÃë)
  74          //      DS18B20_PORT = 1;//ÊÍ·Å×ÜÏß
  75          //      delay_10us(6);   //ÑÓÊ± 60 us
  76          //    }
  77          //    else               //Ð´Èë 0 Ê±Ðò
  78          //    {
  79          //      DS18B20_PORT = 0;//Ö÷»úÀ­µÍ×ÜÏß
  80          //      delay_10us(6);   //ÑÓÊ± 60 us
  81          //      DS18B20_PORT = 1;//ÊÍ·Å×ÜÏß
  82          //      _nop_();_nop_(); //ÑÓÊ±Á½ºÁÃë(¸Ãº¯ÊýÎªÍ·ÎÄ¼þintrins.hÀïµÄº¯Êý£¬Ò»¸ö_nop_()±íÊ¾ÑÓÊ± 1 ºÁÃë)
  83          //    }
  84          //  }
  85          //}
  86          
  87          ///*******************************************************************************
  88          //* º¯ Êý Ãû         : ds18b20_read_bit
  89          //* º¯Êý¹¦ÄÜ           : ´ÓDS18B20¶ÁÈ¡Ò»¸öÎ»
  90          //* Êä    Èë         : ÎÞ
  91          //* Êä    ³ö         : 1/0
  92          //*******************************************************************************/
  93          //u8 ds18b20_read_bit(void)
  94          //{
  95          //  u8 dat = 0;
  96          //  DS18B20_PORT = 0;
  97          //  _nop_();_nop_();
  98          //  DS18B20_PORT = 1;
  99          //  _nop_();_nop_();  //¸Ã¶ÎÊ±¼ä²»ÄÜ¹ý³¤£¬±ØÐëÔÚ15usÄÚ¶ÁÈ¡Êý¾Ý
 100          //  if(DS18B20_PORT) 
 101          //    dat = 1;        //Èç¹û×ÜÏßÉÏÎª1ÔòÊý¾ÝdatÎª1£¬·ñÔòÎª0
 102          //  else
 103          //    dat = 0;
 104          //  delay_10us(5);
 105          //  return dat;
 106          //}
 107          
 108          ///*******************************************************************************
 109          //* º¯ Êý Ãû         : ds18b20_read_byte
 110          //* º¯Êý¹¦ÄÜ           : ´ÓDS18B20¶ÁÈ¡Ò»¸ö×Ö½Ú
 111          //* Êä    Èë         : ÎÞ
 112          //* Êä    ³ö         : Ò»¸ö×Ö½ÚÊý¾Ý
C51 COMPILER V9.60.7.0   DS18B20                                                           11/11/2023 13:00:55 PAGE 3   

 113          //*******************************************************************************/
 114          //u8 ds18b20_read_byte(void)
 115          //{
 116          //  u8 i = 0;
 117          //  u8 dat = 0;
 118          //  u8 temp = 0;
 119          //  for(i = 0;i < 8;i++)  //Ñ­»·8´Î£¬Ã¿´Î¶ÁÈ¡Ò»Î»£¬ÇÒÏÈ¶ÁµÍÎ»ÔÙ¶Á¸ßÎ»
 120          //  {
 121          //    temp = ds18b20_read_bit(); //½«½ÓÊÕµ½µÄÎ»¸³¸øtemp ÀýÈçtemp½ÓÊÕµ½1
 122          //    dat = (temp << 7) | (dat >> 1); //datÏòÓÒÒÆ¶¯Ò»Î»£¬½«×î¸ßÎ»ÒÆµ½´Î¸ßÎ»,tempÏò×óÒÆ¶¯7Î»½«×îµÍÎ»ÒÆµ½×î¸ßÎ
             -»
 123          //                         // 0000 0001 << 7 --> 1000 0000 ,½Ó×ÅÁ½¸ö½øÐÐ»òÔËËãµÄ½á¹û¸³¸ødat£¬´ËÄ¿µÄÊÇÎªÁË±£Á
             -ôdatµÄÖµ 
 124          //                         //½Ó×Å½«datÏòÓÒÒÆ¶¯1Î»µ½´Î¸ßÎ»ÓëÖØÐÂ½ÓÊÕµ½µÄtempÏò×óÒÆ¶¯7Î»À´½øÐÐ»òÔËËã£¬ÒÔ´ËÀàÍÆ
             -½øÐÐ°Ë´ÎÑ­»·
 125          //  }
 126          //  return dat;
 127          //}
 128          
 129          ///*******************************************************************************
 130          //* º¯ Êý Ãû         : ds18b20_start
 131          //* º¯Êý¹¦ÄÜ           : ¿ªÊ¼ÎÂ¶È×ª»»
 132          //* Êä    Èë         : ÎÞ
 133          //* Êä    ³ö         : ÎÞ
 134          //*******************************************************************************/
 135          //void ds18b20_start(void)
 136          //{
 137          //  ds18b20_reset();          //¸´Î»
 138          //  ds18b20_check();          //¼ì²éDS18B20ÊÇ·ñ´æÔÚ
 139          //  ds18b20_write_byte(0xCC); //·¢SKIP ROM ÃüÁî
 140          //  ds18b20_write_byte(0x44); //·¢¿ªÊ¼×ª»»ÃüÁî
 141          //}
 142          
 143          ///*******************************************************************************
 144          //* º¯ Êý Ãû         : ds18b20_read_temperture(ÎÂ¶È¶ÁÈ¡º¯Êý)
 145          //* º¯Êý¹¦ÄÜ           : ´Óds18b20µÃµ½ÎÂ¶ÈÖµ
 146          //* Êä    Èë         : ÎÞ
 147          //* Êä    ³ö         : ÎÂ¶ÈÊý¾Ý
 148          //*******************************************************************************/
 149          //u8 ds18b20_read_temperture(void)
 150          //{
 151          //  u8 dath = 0; 
 152          //  u8 datl = 0; 
 153          //  u16 value = 0; 
 154          //  float temp;
 155          //  
 156          //  ds18b20_start();
 157          //  ds18b20_reset();          //¸´Î»
 158          //  ds18b20_check();          //¼ì²éDS18B20ÊÇ·ñ´æÔÚ
 159          //  ds18b20_write_byte(0xCC); //·¢SKIP ROM ÃüÁî
 160          //  ds18b20_write_byte(0xBE); //¶Á´æ´¢Æ÷
 161          //  
 162          //  datl = ds18b20_read_byte(); //µÍ°ËÎ»×Ö½ÚÊý¾Ý
 163          //  dath = ds18b20_read_byte(); //¸ß°ËÎ»×Ö½ÚÊý¾Ý
 164          //  value = (dath << 8) + datl;//ºÏ²¢Îª16Î»µÄÊý¾Ý
 165          //  
 166          //  if(value && 0xF800 == 0xf800) //ÅÐ¶Ï·ûºÅÎ»£¬¸ºÎÂ¶È(Èç¹û¸Ã16Î»Êý¾ÝÖÐÇ°ÎåÎ»Îª 1 Ôò±íÊ¾ÎÂ¶ÈÐ¡ÓÚ0 )
 167          //  {
 168          //    value = (~value) + 1;     //¶ÁÈ¡µ½µÄÊý¾ÝÈ¡·´ÔÙ¼Ó1
 169          //    temp = value * (-0.0625); //³ËÒÔ¾«¶È
 170          //  }
 171          //  else   //Èç¹û¸Ã16Î»Êý¾ÝÖÐÇ°ÎåÎ»Îª 0 Ôò±íÊ¾ÎÂ¶È´óÓÚ0
C51 COMPILER V9.60.7.0   DS18B20                                                           11/11/2023 13:00:55 PAGE 4   

 172          //    temp = value * 0.0625; //¶ÁÈ¡µ½µÄÊý¾ÝÖ±½Ó³ËÒÔ¾«¶ÈµÃ³öÎÂ¶È
 173          //  return temp;
 174          //}
 175          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   ----    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
